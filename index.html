<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>J&K Career Navigator | Project Pinnacle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap');
        
        :root {
            --primary-accent: #4A69E2; /* Deep Blue from Brief */
            --primary-accent-dark: #3B5CDC;
            --primary-accent-light: #eff2fe;
            --secondary-accent: #FFAF45; /* Saffron Accent from Brief */
            --secondary-accent-dark: #fca130;
            --text-primary: #111827;
            --text-secondary: #4b5563;
            --bg-main: #f9fafb;
            --bg-card: #ffffff;
            --border-color: #e5e7eb;
        }
        
        html { scroll-behavior: smooth; }
        
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .hero-section {
            background-color: #f0f4ff;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23dbeafe' fill-opacity='0.4'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            padding-bottom: 3rem;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: 1.5rem;
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.03), 0 2px 4px -2px rgba(0, 0, 0, 0.03);
            padding: 2rem;
            transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }

        .btn-primary {
            background-color: var(--primary-accent);
            color: white;
            font-weight: 600;
            padding: 0.8rem 1.75rem;
            border-radius: 0.75rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 14px 0 rgba(74, 105, 226, 0.3);
        }
        .btn-primary:hover {
            background-color: var(--primary-accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(74, 105, 226, 0.35);
        }
        
        .btn-secondary {
             background-color: var(--secondary-accent);
             color: white;
             font-weight: 600;
             border-radius: 9999px;
             transition: all 0.2s ease-in-out;
             box-shadow: 0 4px 14px 0 rgba(255, 175, 69, 0.3);
        }
        .btn-secondary:hover {
            background-color: var(--secondary-accent-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px 0 rgba(255, 175, 69, 0.35);
        }


        .nav-bar {
            background-color: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(229, 231, 235, 0.7);
        }
        .nav-button.active {
            background-color: var(--primary-accent);
            color: white;
            box-shadow: 0 4px 12px rgba(74, 105, 226, 0.4);
        }
        
        .quiz-option {
            background-color: var(--bg-main);
            border: 2px solid var(--border-color);
            border-radius: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .quiz-option:hover {
            border-color: var(--primary-accent);
            background-color: var(--primary-accent-light);
        }
        .quiz-option.selected {
            background-color: var(--primary-accent-light);
            border-color: var(--primary-accent);
            color: var(--primary-accent-dark);
            font-weight: 700;
            box-shadow: 0 0 0 3px rgba(74, 105, 226, 0.2);
        }
        
        .chat-message { padding: 0.75rem 1rem; border-radius: 1.25rem; max-width: 85%; word-wrap: break-word; line-height: 1.5; }
        .user-message { background-color: var(--primary-accent); color: white; align-self: flex-end; border-bottom-right-radius: 0.25rem; }
        .bot-message { background-color: #e5e7eb; color: #1f2937; align-self: flex-start; border-bottom-left-radius: 0.25rem; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.25, 0.8, 0.25, 1) forwards; }
        
        .stagger-in > * { opacity: 0; animation: fadeIn 0.6s cubic-bezier(0.25, 0.8, 0.25, 1) forwards; }
        .stagger-in > *:nth-child(1) { animation-delay: 0.1s; }
        .stagger-in > *:nth-child(2) { animation-delay: 0.2s; }
        .stagger-in > *:nth-child(3) { animation-delay: 0.3s; }

        #chatbot-fab {
            background-color: var(--secondary-accent);
            box-shadow: 0 6px 20px 0 rgba(255, 175, 69, 0.4);
        }
         #chatbot-fab:hover {
            background-color: var(--secondary-accent-dark);
        }

        @keyframes drop {
            100% {
                transform: translateY(110vh) rotate(720deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-0">

    <div id="app" class="container mx-auto">
        <div id="timeline-notification" class="fixed top-24 right-4 z-[1001] p-4 bg-green-500 border-l-4 border-green-700 text-white shadow-lg rounded-lg transform translate-x-full transition-all duration-500 ease-in-out opacity-0 pointer-events-none">
            <p class="font-bold">Success!</p>
            <p id="timeline-message"></p>
        </div>

        <div class="hero-section">
            <header class="text-center px-4 pt-12 md:pt-20">
                <h1 class="text-4xl sm:text-6xl font-extrabold text-gray-900 leading-tight tracking-tight">J&K Career Navigator</h1>
                <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">Your comprehensive guide from confusion to clarity on the path to a successful career.</p>
            </header>
            
            <nav class="nav-bar sticky top-4 z-40 mt-12 mx-auto max-w-lg flex flex-wrap justify-center gap-1 p-1.5 rounded-full shadow-lg">
                <button id="nav-home" class="nav-button flex-1 sm:flex-auto flex items-center justify-center gap-2 py-2 px-4 rounded-full font-semibold text-sm sm:text-base transition-all duration-300 hover:bg-gray-200"><i data-feather="home" class="w-4 h-4"></i>Home</button>
                <button id="nav-quiz" class="nav-button flex-1 sm:flex-auto flex items-center justify-center gap-2 py-2 px-4 rounded-full font-semibold text-sm sm:text-base transition-all duration-300 hover:bg-gray-200"><i data-feather="compass" class="w-4 h-4"></i>Career Quest</button>
                <button id="nav-colleges" class="nav-button flex-1 sm:flex-auto flex items-center justify-center gap-2 py-2 px-4 rounded-full font-semibold text-sm sm:text-base transition-all duration-300 hover:bg-gray-200"><i data-feather="book-open" class="w-4 h-4"></i>Colleges</button>
                <button id="nav-map" class="nav-button flex-1 sm:flex-auto flex items-center justify-center gap-2 py-2 px-4 rounded-full font-semibold text-sm sm:text-base transition-all duration-300 hover:bg-gray-200"><i data-feather="map" class="w-4 h-4"></i>Career Maps</button>
                <button id="nav-exams" class="nav-button flex-1 sm:flex-auto flex items-center justify-center gap-2 py-2 px-4 rounded-full font-semibold text-sm sm:text-base transition-all duration-300 hover:bg-gray-200"><i data-feather="edit-3" class="w-4 h-4"></i>Exam Hub</button>
            </nav>
        </div>

        <main id="content-area" class="px-4 sm:px-8 py-12">
            <div id="section-home">
                <!-- Content will be rendered by JavaScript -->
            </div>
            
            <div id="section-quiz" class="hidden"></div>
            <div id="section-colleges" class="hidden"></div>
            <div id="section-map" class="hidden"></div>
            <div id="section-exams" class="hidden"></div>
        </main>
        
        <div id="chatbot-fab" class="fixed bottom-8 right-8 z-[1000] w-16 h-16 rounded-full text-white flex items-center justify-center cursor-pointer shadow-xl transform transition-all duration-300 hover:scale-110 hover:rotate-12">
            <i data-feather="message-square" class="w-8 h-8"></i>
        </div>
        <div id="chatbot-window" class="fixed bottom-28 right-8 w-[370px] h-[550px] bg-white rounded-2xl shadow-2xl flex flex-col z-[999] hidden origin-bottom-right transition-all duration-300 transform scale-0 opacity-0">
            <div class="p-4 bg-gradient-to-r from-primary-accent to-primary-accent-dark text-white rounded-t-2xl"><h3 class="font-bold text-lg">AI Career Counselor</h3></div>
            <div id="chat-messages" class="flex-1 p-4 space-y-4 overflow-y-auto flex flex-col bg-gray-50"></div>
            <div class="p-3 border-t flex items-center space-x-2 bg-white rounded-b-2xl">
                <input type="text" id="chat-input" placeholder="Ask anything..." class="flex-1 p-3 border-0 rounded-full bg-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-accent">
                <button id="chat-send-btn" class="btn-secondary w-11 h-11 flex items-center justify-center"><i data-feather="arrow-up" class="w-6 h-6"></i></button>
            </div>
        </div>
        <div id="congrats-animation" class="fixed inset-0 pointer-events-none z-[1002] overflow-hidden"></div>
    </div>
    
    <script>
        // --- Image Fallback Logic ---
        function createPlaceholderSvg(text = 'Image') {
            const bgColor = '#e5e7eb'; const textColor = '#9ca3af';
            const svg = `<svg viewBox="0 0 600 400" xmlns="http://www.w3.org/2000/svg"><rect width="100%" height="100%" fill="${bgColor}" /><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-family="'Plus Jakarta Sans', sans-serif" font-size="24" fill="${textColor}">${text}</text></svg>`;
            return `data:image/svg+xml;base64,${btoa(svg)}`;
        }
        function handleImageError(img) { img.src = createPlaceholderSvg(img.alt); img.onerror = null; }
        
        // --- Core Application Logic ---
        let currentView = 'home'; let currentQuestionIndex = 0; let quizAnswers = {}; let myApplications = [];
        
        // --- Data (Restored with full details) ---
        const quizData = [ { q: "When facing a complex problem, you prefer to:", o: [{ t: "Analyze details & create a logical plan.", c: "Technical" }, { t: "Brainstorm creative, out-of-the-box ideas.", c: "Creative" }, { t: "Collaborate and gather diverse opinions.", c: "Social" }, { t: "Take charge and develop a strategy.", c: "Entrepreneurial" }] }, { q: "Which weekend project excites you most?", o: [{ t: "Building a small robot or coding a fun app.", c: "Technical" }, { t: "Painting, writing, or composing music.", c: "Creative" }, { t: "Organizing a community volunteer event.", c: "Social" }, { t: "Drafting a business plan for a new idea.", c: "Entrepreneurial" }] }, { q: "Your favorite school subjects were likely:", o: [{ t: "Physics, Math, & Computer Science.", c: "Technical" }, { t: "Literature, Art, & Music.", c: "Creative" }, { t: "History, Psychology, & Sociology.", c: "Social" }, { t: "Economics & Business Studies.", c: "Entrepreneurial" }] } ];
        const resultDescriptions = { "Technical": "You have a logical, analytical mind, ideal for engineering, IT, or science.", "Creative": "You're an imaginative thinker, perfect for design, arts, or media.", "Social": "You're empathetic and community-oriented, suited for social work, teaching, or healthcare.", "Entrepreneurial": "You're a natural leader and innovator, built for business or starting your own venture." };
        const careerPathData = [ { c: "Technical", d: "B.Tech Software Engineering", s: [{ n: "Master Core Languages", details: "Focus on Python, Java, or JavaScript.", courses: [{name: "CS50 on edX", url:"https://www.edx.org/course/introduction-computer-science-harvardx-cs50x"}], scholarships: [{name: "Google Scholarships", url: "https://buildyourfuture.withgoogle.com/scholarships"}] }, { n: "Learn Data Structures & Algorithms", details: "Essential for problem-solving and interviews." }, { n: "Build a Portfolio of Projects", details: "Showcase your skills with real-world examples." }] }, { c: "Creative", d: "B.A. Graphic Design", s: [{ n: "Master Design Principles", details: "Understand color theory, typography, and layout." , courses: [{name: "Canva Design School", url:"https://www.canva.com/designschool/"}]}, { n: "Learn Adobe Creative Suite", details: "Photoshop, Illustrator, and InDesign are industry standards.", scholarships: [{name: "Adobe Design Scholarships", url:"https://www.adobe.com/scholarships"}] }, { n: "Develop a Strong Online Portfolio", details: "Your portfolio is your most important asset." }] }, { c: "Social", d: "B.S.W. Social Work", s: [{ n: "Gain Field Experience via Internships", details: "Practical experience is crucial in this field.", courses: [{name: "Intro to Social Work", url:"https://www.coursera.org/learn/social-work"}] }, { n: "Develop Counseling Skills", details: "Learn active listening and empathy." }, { n: "Study Social Policies", details: "Understand the systems you'll be working within.", scholarships: [{name: "Tata Trust Scholarships", url:"https://www.tatatrusts.org/our-work/education/scholarships"}] }] }, { c: "Entrepreneurial", d: "BBA in Entrepreneurship", s: [{ n: "Learn Business & Financial Planning", details: "Create a solid foundation for your venture.", courses: [{name: "Y Combinator Startup School", url:"https://www.ycombinator.com/school"}] }, { n: "Develop Networking & Pitching Skills", details: "Effectively communicate your vision." }, { n: "Launch a Small-Scale Venture", details: "Apply your learning with a real project.", scholarships: [{name: "JKEDI Grants", url:"http://jkedi.org/"}] }] } ];
        const collegeData = [ { id: 1, n: "University of Jammu", l: "Jammu", i: "https://images.unsplash.com/photo-1562774053-701939374585?auto=format&fit=crop&q=80&w=800", cat: ["Technical", "Social", "Creative"] }, { id: 6, n: "IIT Jammu", l: "Jammu", i: "https://images.unsplash.com/photo-1581362072494-a3399b1a5e12?auto=format&fit=crop&q=80&w=800", cat: ["Technical"] }, { id: 7, n: "IIM Jammu", l: "Jammu", i: "https://images.unsplash.com/photo-1552581234-26160f608093?auto=format&fit=crop&q=80&w=800", cat: ["Entrepreneurial"] }, { id: 16, n: "University of Kashmir", l: "Srinagar", i: "https://images.unsplash.com/photo-1627891152234-a293469624d3?auto=format&fit=crop&q=80&w=800", cat: ["Social", "Creative", "Technical"] }, { id: 17, n: "NIT Srinagar", l: "Srinagar", i: "https://images.unsplash.com/photo-1554475901-4538ddfbccc2?auto=format&fit=crop&q=80&w=800", cat: ["Technical"] }, { id: 18, n: "SKIMS Medical College", l: "Srinagar", i: "https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&q=80&w=800", cat: ["Technical", "Social"] } ];
        const examData = [ { n: "NEET (UG)", rd: "2026-02-01", ed: "2026-05-05", d: "For admission to undergraduate medical courses.", w: "https://exams.nta.ac.in/NEET/" }, { n: "JEE Main", rd: "2025-12-01", ed: "2026-01-24", d: "For admission to undergraduate engineering programs.", w: "https://jeemain.nta.ac.in/" }, { n: "CUET", rd: "2026-02-27", ed: "2026-05-15", d: "For admission to Central Universities.", w: "https://cuet.samarth.ac.in/" } ];

        // --- Element References ---
        const views = { home: document.getElementById('section-home'), quiz: document.getElementById('section-quiz'), colleges: document.getElementById('section-colleges'), map: document.getElementById('section-map'), exams: document.getElementById('section-exams') };
        const navButtons = { home: document.getElementById('nav-home'), quiz: document.getElementById('nav-quiz'), colleges: document.getElementById('nav-colleges'), map: document.getElementById('nav-map'), exams: document.getElementById('nav-exams') };
        
        function navigate(view) {
            currentView = view;
            Object.values(views).forEach(v => v.classList.add('hidden'));
            views[view].classList.remove('hidden');
            setTimeout(() => views[view].classList.add('fade-in'), 10);
            Object.values(navButtons).forEach(b => b.classList.remove('active'));
            navButtons[view].classList.add('active');
            if (view !== 'home') { window.scrollTo({ top: document.querySelector('.hero-section').offsetHeight - 80, behavior: 'smooth' }); } 
            else { window.scrollTo({ top: 0, behavior: 'smooth' }); }
        }

        function renderSection(view) {
            const section = views[view]; section.innerHTML = '';
            switch(view) {
                case 'home':
                    renderHome(); break;
                case 'quiz':
                    section.innerHTML = `<div class="max-w-4xl mx-auto"><div id="quiz-card" class="card"><h2 class="text-3xl font-bold text-gray-900 mb-6 text-center">Career Quest</h2><div class="w-full bg-gray-200 rounded-full h-2.5 mb-8"><div id="quiz-progress-bar" class="bg-primary-accent h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div></div><div id="quiz-container"></div></div><div id="quiz-results-display" class="mt-8"></div></div>`;
                    startQuiz(); break;
                case 'colleges':
                    section.innerHTML = `<h2 class="text-3xl font-bold text-center text-gray-900 mb-8">Colleges & Universities</h2><div id="college-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 stagger-in"></div>`;
                    renderColleges(); break;
                case 'map':
                    section.innerHTML = `<h2 class="text-3xl font-bold text-center text-gray-900 mb-8">Visual Career Maps</h2><div id="career-paths-container" class="space-y-6"></div>`;
                    renderAllCareerMaps(); break;
                case 'exams':
                    section.innerHTML = `<h2 class="text-3xl font-bold text-center text-gray-900 mb-8">Entrance Exam Hub</h2><div id="exam-hub-container" class="space-y-8 stagger-in"></div>`;
                    renderExamHub(); break;
            }
            feather.replace();
        }

        function renderHome() {
            const section = views.home;
            section.innerHTML = `
                <div class="card text-center">
                    <h2 class="text-3xl font-bold text-gray-900 mb-4">Chart Your Future Today</h2>
                    <p class="text-gray-600 mb-6 max-w-xl mx-auto">Embark on a journey of self-discovery with our "Career Quest" quiz. Uncover your passions and skills to unlock a personalized dashboard guiding you to the perfect career.</p>
                    <button id="start-quiz-btn" class="btn-primary">Start Your Career Quest <i data-feather="arrow-right" class="inline-block w-5 h-5 ml-2"></i></button>
                </div>
                <div id="my-applications" class="mt-12">
                    <h3 class="text-3xl font-bold mb-6 text-center">My Application Timeline</h3>
                    <div id="applications-list" class="space-y-4"></div>
                </div>
            `;
            document.getElementById('start-quiz-btn').addEventListener('click', () => { navigate('quiz'); renderSection('quiz'); });
            renderMyApplications();
        }

        // --- State & Timeline ---
        const saveState = () => { localStorage.setItem('cn_apps', JSON.stringify(myApplications)); localStorage.setItem('cn_result', quizAnswers.result || ''); };
        function loadState() {
            myApplications = JSON.parse(localStorage.getItem('cn_apps') || '[]');
            const savedResult = localStorage.getItem('cn_result');
            if(savedResult) { 
                quizAnswers.result = savedResult; 
                navigate('quiz'); 
                renderSection('quiz'); 
                document.getElementById('quiz-card').classList.add('hidden'); 
                renderResultsPage(savedResult); 
            } else { 
                navigate('home'); 
                renderSection('home');
            }
        }
        function addToApplications(collegeId) {
            const college = collegeData.find(c => c.id === collegeId);
            if (college && !myApplications.find(app => app.id === collegeId)) {
                myApplications.push({ id: college.id, name: college.n, status: 'Not Started' });
                saveState(); 
                if(currentView === 'home') { renderMyApplications(); }
                const notification = document.getElementById('timeline-notification');
                notification.querySelector('#timeline-message').innerText = `${college.n} added to your timeline.`;
                notification.classList.remove('translate-x-full', 'opacity-0', 'pointer-events-none');
                setTimeout(() => {
                    notification.classList.add('translate-x-full', 'opacity-0', 'pointer-events-none');
                }, 3000);
            }
        }
        const removeApplication = (id) => { myApplications = myApplications.filter(a => a.id !== id); saveState(); renderMyApplications(); };
        const updateApplicationStatus = (id, status) => { 
            const app = myApplications.find(a => a.id === id); 
            if(app) { 
                app.status = status; 
                saveState(); 
                renderMyApplications(); 
                if (status === 'Accepted') {
                    showCongratsAnimation();
                }
            } 
        };
        function renderMyApplications() {
            const list = document.getElementById('applications-list');
            if (!list) return;
            if (myApplications.length === 0) { list.innerHTML = `<div class="text-center py-10 px-6 bg-gray-50 rounded-2xl"><i data-feather="folder-plus" class="w-12 h-12 mx-auto text-gray-400 mb-4"></i><h4 class="text-xl font-semibold">Timeline is Empty</h4><p class="text-gray-500 mt-2">Add colleges to track them here.</p></div>`; }
            else { 
                const statusOptions = ['Not Started', 'In Progress', 'Submitted', 'Accepted'];
                const statusBorderColors = { 'Not Started': 'border-gray-300', 'In Progress': 'border-yellow-400', 'Submitted': 'border-blue-500', 'Accepted': 'border-green-500' };
                list.innerHTML = myApplications.map(app => `
                <div class="bg-white rounded-2xl p-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 border-l-4 ${statusBorderColors[app.status]} shadow-sm">
                    <p class="font-bold text-lg text-gray-800 flex-grow">${app.name}</p>
                    <div class="flex items-center gap-4 w-full sm:w-auto">
                        <select class="p-2 border border-gray-300 rounded-lg shadow-sm w-full sm:w-auto bg-white" onchange="updateApplicationStatus(${app.id}, this.value)">
                            ${statusOptions.map(o => `<option value="${o}" ${app.status === o ? 'selected' : ''}>${o}</option>`).join('')}
                        </select>
                        <button class="text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-100" onclick="removeApplication(${app.id})"><i data-feather="trash-2" class="w-5 h-5"></i></button>
                    </div>
                </div>`).join(''); 
            }
            feather.replace();
        }

        // --- Quiz ---
        const startQuiz = () => { currentQuestionIndex = 0; quizAnswers = {}; renderQuestion(); };
        function renderQuestion() {
            const container = document.getElementById('quiz-container'), progress = document.getElementById('quiz-progress-bar');
            if(!container || !progress) return;
            progress.style.width = `${(currentQuestionIndex / quizData.length) * 100}%`;
            if (currentQuestionIndex >= quizData.length) { container.innerHTML = `<div class="text-center p-8"><h3 class="text-2xl font-bold mb-6">Quest Complete!</h3><button id="show-results-btn" class="btn-primary">View My Personalized Dashboard</button></div>`; document.getElementById('show-results-btn').onclick = calculateResults; return; }
            const q = quizData[currentQuestionIndex];
            container.innerHTML = `<p class="text-xl font-semibold mb-6 text-center">${q.q}</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4">${q.o.map(opt => `<div class="quiz-option p-4 text-center" onclick="selectAnswer('${opt.c}', this)">${opt.t}</div>`).join('')}</div>`;
        }
        function selectAnswer(c, el) { document.querySelectorAll('.quiz-option').forEach(e => e.classList.remove('selected')); el.classList.add('selected'); quizAnswers[c] = (quizAnswers[c] || 0) + 1; setTimeout(() => { currentQuestionIndex++; renderQuestion(); }, 400); }
        function calculateResults() { const result = Object.keys(quizAnswers).reduce((a, b) => quizAnswers[a] > quizAnswers[b] ? a : b); quizAnswers.result = result; saveState(); document.getElementById('quiz-card').classList.add('hidden'); renderResultsPage(result); }
        function renderResultsPage(c) {
            const display = document.getElementById('quiz-results-display');
            const maps = careerPathData.filter(p => p.c === c); const colleges = collegeData.filter(col => col.cat.includes(c)).slice(0, 3);
            display.innerHTML = `<div class="text-center p-8 bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl mb-12 fade-in"><h3 class="text-sm font-bold uppercase tracking-wider text-primary-accent mb-2">Your Profile</h3><h3 class="text-3xl font-bold mb-3">${c}</h3><p class="text-gray-700 max-w-2xl mx-auto">${resultDescriptions[c]}</p></div><div class="grid grid-cols-1 lg:grid-cols-2 gap-12"><div class="stagger-in"><h4 class="text-2xl font-bold text-gray-800 mb-6">Recommended Career Maps</h4><div class="space-y-6">${maps.map(createCareerMapHTML).join('')}</div></div><div class="stagger-in"><h4 class="text-2xl font-bold text-gray-800 mb-6">Top College Picks</h4><div class="space-y-6">${colleges.map(createCollegeCardHTML).join('')}</div></div></div><div class="text-center mt-12"><button class="btn-primary" onclick="startQuiz()">Retake Career Quest</button></div>`;
            feather.replace();
        }
        
        // --- Rendering Functions ---
        const createCollegeCardHTML = c => `<div class="card p-0 flex flex-col justify-between overflow-hidden"><div><img src="${c.i}" alt="${c.n}" class="w-full h-48 object-cover" onerror="handleImageError(this)"><div class="p-6"><h4 class="text-xl font-bold text-gray-900">${c.n}</h4><p class="text-gray-600 font-semibold flex items-center gap-1 mt-1"><i data-feather="map-pin" class="w-4 h-4"></i>${c.l}</p></div></div><div class="px-6 pb-6 pt-0"><button class="btn-primary w-full" onclick="addToApplications(${c.id})">Add to Timeline</button></div></div>`;
        const createCareerMapHTML = p => `<div class="card"><h3 class="font-bold text-lg">${p.d}</h3><div class="mt-4 divide-y divide-gray-200">${p.s.map((s,i) => `<div class="py-3"><div class="flex items-center gap-3"><span class="flex-shrink-0 w-6 h-6 bg-primary-accent-light text-primary-accent font-bold text-sm rounded-full flex items-center justify-center">${i+1}</span><p class="font-semibold">${s.n}</p></div><p class="pl-9 text-sm text-gray-600">${s.details || ''}</p>${s.courses ? `<div class="pl-9 mt-2"><a href="${s.courses[0].url}" target="_blank" class="text-sm text-primary-accent hover:underline">Recommended Course <i class="w-3 h-3 inline-block" data-feather="external-link"></i></a></div>` : ''}${s.scholarships ? `<div class="pl-9 mt-1"><a href="${s.scholarships[0].url}" target="_blank" class="text-sm text-primary-accent hover:underline">Find Scholarships <i class="w-3 h-3 inline-block" data-feather="external-link"></i></a></div>` : ''}</div>`).join('')}</div></div>`;
        const renderColleges = () => { document.getElementById('college-list').innerHTML = collegeData.map(createCollegeCardHTML).join(''); feather.replace(); };
        const renderAllCareerMaps = () => { document.getElementById('career-paths-container').innerHTML = careerPathData.map(createCareerMapHTML).join(''); feather.replace(); };
        function renderExamHub() {
            const container = document.getElementById('exam-hub-container');
            container.innerHTML = examData.map(exam => `<div class="card p-6 border-l-4 border-secondary-accent"><h3 class="text-2xl font-bold">${exam.n}</h3><p class="text-gray-600 mt-2">${exam.d}</p><div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6 text-center"><div><p class="text-sm font-semibold text-gray-500 uppercase">Registration Ends</p><div id="countdown-${exam.n}-reg" class="text-3xl font-bold text-red-600 mt-1"></div></div><div><p class="text-sm font-semibold text-gray-500 uppercase">Exam Date</p><div id="countdown-${exam.n}-exam" class="text-3xl font-bold text-green-600 mt-1"></div></div></div><div class="mt-6 text-right"><a href="${exam.w}" target="_blank" rel="noopener noreferrer" class="btn-primary text-sm py-2 px-4 inline-flex items-center gap-2">Official Website <i data-feather="external-link" class="w-4 h-4"></i></a></div></div>`).join('');
            updateCountdowns(); feather.replace();
        }
        function updateCountdowns() { examData.forEach(exam => { updateCountdownFor(`countdown-${exam.n}-reg`, exam.rd); updateCountdownFor(`countdown-${exam.n}-exam`, exam.ed); }); }
        function updateCountdownFor(id, date) { const el = document.getElementById(id); if (!el) return; const target = new Date(date).getTime(); const interval = setInterval(() => { const now = new Date().getTime(), dist = target - now; if (dist < 0) { el.innerHTML = "EXPIRED"; clearInterval(interval); return; } el.innerHTML = `${Math.floor(dist/(1000*60*60*24))}d ${Math.floor((dist%(1000*60*60*24))/(1000*60*60))}h ${Math.floor((dist%(1000*60*60))/(1000*60))}m`; }, 1000); }
        
        // --- Animation ---
        function showCongratsAnimation() {
            const container = document.getElementById('congrats-animation');
            if (!container) return;
            container.innerHTML = '';
            const confettiCount = 150;
            const colors = ['#f59e0b', '#ef4444', '#10b981', '#4A69E2', '#8b5cf6', '#ec4899'];
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'absolute';
                confetti.style.width = `${Math.random() * 12 + 6}px`;
                confetti.style.height = `${Math.random() * 20 + 10}px`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.top = '-50px';
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.opacity = '1';
                const duration = Math.random() * 3 + 2.5;
                confetti.style.animation = `drop ${duration}s ease-in-out forwards`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                container.appendChild(confetti);
            }
            setTimeout(() => { container.innerHTML = ''; }, 6000);
        }

        // --- Chatbot (Restored) ---
        const chatbotFab = document.getElementById('chatbot-fab'), chatbotWindow = document.getElementById('chatbot-window'), chatMessages = document.getElementById('chat-messages'), chatInput = document.getElementById('chat-input'), chatSendBtn = document.getElementById('chat-send-btn');
        const parseMarkdown = text => text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
        function addChatMessage(message, sender, isLoading = false) {
            const el = document.createElement('div'); el.className = `chat-message ${sender}-message`;
            if (isLoading) { el.innerHTML = `<div class="flex items-center space-x-2"><div class="w-2 h-2 rounded-full bg-gray-400 animate-pulse"></div><div class="w-2 h-2 rounded-full bg-gray-400 animate-pulse [animation-delay:0.2s]"></div><div class="w-2 h-2 rounded-full bg-gray-400 animate-pulse [animation-delay:0.4s]"></div></div>`; el.id = 'loading-indicator'; } 
            else { el.innerHTML = parseMarkdown(message); }
            chatMessages.appendChild(el); chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        async function getGeminiResponse(prompt) {
            const apiKey = ""; // Leave blank, will be handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const systemPrompt = "You are a friendly and encouraging career counselor for students in Jammu & Kashmir. Keep answers concise, helpful, and relevant to their local context. If you don't know an answer, say so. Use simple markdown for formatting.";
            const payload = { contents: [{ parts: [{ text: prompt }] }], systemInstruction: { parts: [{ text: systemPrompt }] } };
            const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
            if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
            const result = await response.json();
            return result.candidates?.[0]?.content?.parts?.[0]?.text || "Sorry, I couldn't generate a response right now.";
        }
        async function handleChatMessage() {
            const userInput = chatInput.value.trim(); if (userInput === "") return;
            addChatMessage(userInput, 'user'); chatInput.value = ""; addChatMessage('', 'bot', true);
            try {
                const botResponse = await getGeminiResponse(userInput);
                const loading = document.getElementById('loading-indicator'); if(loading) loading.remove();
                addChatMessage(botResponse, 'bot');
            } catch (error) {
                const loading = document.getElementById('loading-indicator'); if(loading) loading.remove();
                addChatMessage("Sorry, I'm having trouble connecting. Please try again later.", 'bot');
                console.error("Chatbot Error:", error);
            }
        }
        
        // --- Init ---
        window.addEventListener('DOMContentLoaded', () => {
            feather.replace();
            
            navButtons.home.addEventListener('click', () => {
                navigate('home');
                renderSection('home');
            });
            ['quiz', 'colleges', 'map', 'exams'].forEach(key => {
                navButtons[key].addEventListener('click', () => {
                    if (currentView !== key) {
                        navigate(key);
                        renderSection(key);
                    }
                });
            });
            
            chatbotFab.addEventListener('click', () => { if(chatbotWindow.classList.contains('scale-0')) { chatbotWindow.classList.remove('hidden', 'scale-0', 'opacity-0'); } else { chatbotWindow.classList.add('scale-0', 'opacity-0'); setTimeout(() => chatbotWindow.classList.add('hidden'), 300); } });
            chatSendBtn.addEventListener('click', handleChatMessage);
            chatInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') handleChatMessage(); });
            addChatMessage("Hello! Ask me about colleges, exams, or career paths in J&K.", "bot");
            loadState();
        });
    </script>
</body>
</html>

